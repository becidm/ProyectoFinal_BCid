ïš
aC:\Cursos\CodificaciÃ³n Segura\ProyectoFinalSeguridadApps\Business_SeguridadApps\BusinessRules.cs
	namespace 	"
Business_SeguridadApps
  
{		 
public

 

class

 
BusinessRules

 
{ 
static 
readonly 
string 
notvalid_chr +
=, -
$str. :
;: ;
static 
readonly 
string 
creditcard_pattern 1
=2 3
$str4 ^
;^ _
const 
string 
pattern 
= 
$str 4
;4 5
bool 
ValidateMatch 
( 
string !
InputString" -
)- .
{ 	
try 
{ 
return 
Regex 
. 
IsMatch $
($ %
InputString% 0
,0 1
pattern2 9
)9 :
;: ;
} 
catch 
( &
RegexMatchTimeoutException -
)- .
{ 
return 
false 
; 
} 
}!! 	
public'' 
InputResult'' 
ValidateInputText'' ,
('', -
string''- 3
InputString''4 ?
)''? @
{(( 	
InputResult)) 
result)) 
=))  
new))! $
InputResult))% 0
())0 1
)))1 2
;))2 3
try** 
{++ 
result,, 
.,, 
IsMatch,, 
=,,  
ValidateMatch,,! .
(,,. /
InputString,,/ :
),,: ;
;,,; <
if-- 
(-- 
!-- 
result-- 
.-- 
IsMatch-- #
)--# $
{.. 
result// 
.// 
SanitizedString// *
=//+ ,
Regex//- 2
.//2 3
Replace//3 :
(//: ;
InputString//; F
,//F G
@notvalid_chr//H U
,//U V
$str//W Y
)//Y Z
;//Z [
if00 
(00 
result00 
.00 
SanitizedString00 .
.00. /
Length00/ 5
<006 7
InputString008 C
.00C D
Length00D J
)00J K
{11 
result22 
.22 
Message22 &
=22' (
$str22) X
+22Y Z
result22[ a
.22a b
SanitizedString22b q
;22q r
}33 
result44 
.44 
IsMatch44 "
=44# $
true44% )
;44) *
}55 
else66 
{77 
result99 
.99 
SanitizedString99 *
=99+ ,
InputString99- 8
;998 9
result:: 
.:: 
Message:: "
=::# $
$str::% A
;::A B
};; 
}<< 
catch== 
(== &
RegexMatchTimeoutException== -
ex==. 0
)==0 1
{>> 
result?? 
.?? 
IsMatch?? 
=??  
false??! &
;??& '
result@@ 
.@@ 
Message@@ 
=@@  
ex@@! #
.@@# $
Message@@$ +
;@@+ ,
}AA 
returnBB 
resultBB 
;BB 
}CC 	
publicII 

CreditCardII 
GetCreditCardInfoII +
(II+ ,
stringII, 2
	inputTextII3 <
)II< =
{JJ 	

CreditCardKK 
ccKK 
=KK 
newKK 

CreditCardKK  *
(KK* +
)KK+ ,
;KK, -
tryLL 
{MM 
ccNN 
.NN 
CreditCardNumberNN #
=NN$ %
GetCreditCardNumNN& 6
(NN6 7
	inputTextNN7 @
)NN@ A
;NNA B
ccOO 
.OO 
IndexOO 
=OO "
GetCreditCardNum_IndexOO 1
(OO1 2
	inputTextOO2 ;
)OO; <
;OO< =
ifPP 
(PP 
!PP 
stringPP 
.PP 
IsNullOrEmptyPP )
(PP) *
ccPP* ,
.PP, -
CreditCardNumberPP- =
)PP= >
)PP> ?
{QQ 
ccRR 
.RR 
IsValidRR 
=RR  
trueRR! %
;RR% &
intSS 
indexSS 
=SS "
GetCreditCardNum_IndexSS  6
(SS6 7
ccSS7 9
.SS9 :
CreditCardNumberSS: J
)SSJ K
;SSK L
varTT 
cardNumber_leftTT '
=TT( )
newTT* -
StringBuilderTT. ;
(TT; <
ccTT< >
.TT> ?
CreditCardNumberTT? O
.TTO P
	SubstringTTP Y
(TTY Z
$numTTZ [
,TT[ \
indexTT] b
)TTb c
)TTc d
;TTd e
varUU 
cardNumber_rightUU (
=UU) *
newUU+ .
StringBuilderUU/ <
(UU< =
ccUU= ?
.UU? @
CreditCardNumberUU@ P
.UUP Q
	SubstringUUQ Z
(UUZ [
indexUU[ `
+UUa b
$numUUc e
)UUe f
)UUf g
;UUg h
stringVV 
substring_auxVV (
=VV) *
ccVV+ -
.VV- .
CreditCardNumberVV. >
.VV> ?
	SubstringVV? H
(VVH I
$numVVI J
,VVJ K
ccVVL N
.VVN O
CreditCardNumberVVO _
.VV_ `
LengthVV` f
-VVg h
$numVVi j
)VVj k
;VVk l
stringWW 
visible_stringWW )
=WW* +
ccWW, .
.WW. /
CreditCardNumberWW/ ?
.WW? @
	SubstringWW@ I
(WWI J
ccWWJ L
.WWL M
CreditCardNumberWWM ]
.WW] ^
LengthWW^ d
-WWe f
$numWWg h
)WWh i
;WWi j
varYY 
masked_stringYY %
=YY& '
newYY( +
StringBuilderYY, 9
(YY9 :
)YY: ;
;YY; <
forZZ 
(ZZ 
intZZ 
iZZ 
=ZZ  
$numZZ! "
;ZZ" #
iZZ$ %
<ZZ& '
substring_auxZZ( 5
.ZZ5 6
LengthZZ6 <
;ZZ< =
iZZ> ?
++ZZ? A
)ZZA B
{[[ 
if\\ 
(\\ 
substring_aux\\ )
.\\) *
	Substring\\* 3
(\\3 4
i\\4 5
,\\5 6
$num\\7 8
)\\8 9
.\\9 :
	CompareTo\\: C
(\\C D
$str\\D G
)\\G H
==\\I K
$num\\L M
||\\N P
string\\Q W
.\\W X
IsNullOrWhiteSpace\\X j
(\\j k
substring_aux\\k x
.\\x y
	Substring	\\y ‚
(
\\‚ ƒ
i
\\ƒ „
,
\\„ …
$num
\\† ‡
)
\\‡ ˆ
)
\\ˆ ‰
)
\\‰ Š
masked_string]] )
.]]) *
Append]]* 0
(]]0 1
substring_aux]]1 >
.]]> ?
	Substring]]? H
(]]H I
i]]I J
,]]J K
$num]]L M
)]]M N
)]]N O
;]]O P
else^^ 
masked_string__ )
.__) *
Append__* 0
(__0 1
substring_aux__1 >
.__> ?
	Substring__? H
(__H I
i__I J
,__J K
$num__L M
)__M N
.__N O
Replace__O V
(__V W
substring_aux__W d
.__d e
	Substring__e n
(__n o
i__o p
,__p q
$num__r s
)__s t
,__t u
$str__v y
)__y z
)__z {
;__{ |
}aa 
varbb 
cardNumber_maskedbb )
=bb* +
masked_stringbb, 9
.bb9 :
Appendbb: @
(bb@ A
visible_stringbbA O
)bbO P
;bbP Q
cccc 
.cc 
CreditCardMaskedcc '
=cc' (
(cc) *
cardNumber_leftcc* 9
.cc9 :
Appendcc: @
(cc@ A
cardNumber_maskedccA R
)ccR S
.ccS T
AppendccT Z
(ccZ [
cardNumber_rightcc[ k
)cck l
)ccl m
.ccm n
ToStringccn v
(ccv w
)ccw x
;ccx y
}dd 
elseee 
{ff 
ccgg 
.gg 
Messagegg 
=gg  !
$strgg" u
;ggu v
throwhh 
newhh !
ArgumentNullExceptionhh 3
(hh3 4
cchh4 6
.hh6 7
Messagehh7 >
)hh> ?
;hh? @
}ii 
}jj 
catchkk 
(kk 
	Exceptionkk 
)kk 
{ll 
ccmm 
.mm 
IsValidmm 
=mm 
falsemm "
;mm" #
}nn 
returnoo 
ccoo 
;oo 
}qq 	
stringww 
GetCreditCardNumww 
(ww  
stringww  &
	inputTextww' 0
)ww0 1
{xx 	
Matchyy 
cardIdyy 
=yy 
Regexyy  
.yy  !
Matchyy! &
(yy& '
	inputTextyy' 0
,yy0 1
creditcard_patternyy2 D
)yyD E
;yyE F
ifzz 
(zz 
cardIdzz 
.zz 
Successzz 
)zz 
return{{ 
cardId{{ 
.{{ 
Value{{ #
;{{# $
else|| 
return}} 
string}} 
.}} 
Empty}} #
;}}# $
}~~ 	
int
„„ $
GetCreditCardNum_Index
„„ "
(
„„" #
string
„„# )
	inputText
„„* 3
)
„„3 4
{
…… 	
Match
†† 
cardId
†† 
=
†† 
Regex
††  
.
††  !
Match
††! &
(
††& '
	inputText
††' 0
,
††0 1 
creditcard_pattern
††2 D
)
††D E
;
††E F
if
‡‡ 
(
‡‡ 
cardId
‡‡ 
.
‡‡ 
Success
‡‡ 
)
‡‡ 
return
ˆˆ 
cardId
ˆˆ 
.
ˆˆ 
Index
ˆˆ #
;
ˆˆ# $
else
‰‰ 
return
ŠŠ 
$num
ŠŠ 
;
ŠŠ 
}
‹‹ 	
public
‘‘ 
EncodingData
‘‘  
EncodingCreditCard
‘‘ .
(
‘‘. /
string
‘‘/ 5
data
‘‘6 :
)
‘‘: ;
{
’’ 	
EncodingData
““ 
ed
““ 
=
““ 
new
““ !
EncodingData
““" .
(
““. /
)
““/ 0
;
““0 1
try
”” 
{
•• 
ed
–– 
.
–– 

cryptoData
–– 
=
–– #
AES256_EncryptManaged
––  5
(
––5 6
data
––6 :
)
––: ;
;
––; <
ed
—— 
.
—— 
SHA256
—— 
=
—— 
GenerateSHA256
—— *
(
——* +
data
——+ /
)
——/ 0
;
——0 1
}
˜˜ 
catch
™™ 
(
™™ 
	Exception
™™ 
ex
™™ 
)
™™  
{
šš 
ed
›› 
.
›› 
Message
›› 
=
›› 
ex
›› 
.
››  
Message
››  '
;
››' (
}
œœ 
return
 
ed
 
;
 
}
 	
string
¤¤ 
GenerateSHA256
¤¤ 
(
¤¤ 
string
¤¤ $
MaskedInput
¤¤% 0
)
¤¤0 1
{
¥¥ 	
StringBuilder
¦¦ 
hash
¦¦ 
=
¦¦  
new
¦¦! $
StringBuilder
¦¦% 2
(
¦¦2 3
)
¦¦3 4
;
¦¦4 5
using
¨¨ 
(
¨¨ 
SHA256
¨¨ 
sha256
¨¨  
=
¨¨! "
SHA256
¨¨# )
.
¨¨) *
Create
¨¨* 0
(
¨¨0 1
)
¨¨1 2
)
¨¨2 3
{
©© 
byte
ªª 
[
ªª 
]
ªª 
	hashValue
ªª  
=
ªª! "
sha256
ªª# )
.
ªª) *
ComputeHash
ªª* 5
(
ªª5 6
Encoding
ªª6 >
.
ªª> ?
UTF8
ªª? C
.
ªªC D
GetBytes
ªªD L
(
ªªL M
MaskedInput
ªªM X
)
ªªX Y
)
ªªY Z
;
ªªZ [
foreach
«« 
(
«« 
byte
«« 
b
«« 
in
««  "
	hashValue
««# ,
)
««, -
{
¬¬ 
hash
­­ 
.
­­ 
Append
­­ 
(
­­  
b
­­  !
.
­­! "
ToString
­­" *
(
­­* +
$str
­­+ /
)
­­/ 0
)
­­0 1
;
­­1 2
}
®® 
}
¯¯ 
return
°° 
hash
°° 
.
°° 
ToString
°°  
(
°°  !
)
°°! "
;
°°" #
}
²² 	

CryptoData
¸¸ #
AES256_EncryptManaged
¸¸ (
(
¸¸( )
string
¸¸) /
EncodedString
¸¸0 =
)
¸¸= >
{
¹¹ 	

CryptoData
ºº 
cd
ºº 
=
ºº 
new
ºº 

CryptoData
ºº  *
(
ºº* +
)
ºº+ ,
;
ºº, -
try
»» 
{
¼¼ 
using
½½ 
(
½½ 

AesManaged
½½ !
aes_managed
½½" -
=
½½. /
new
½½0 3

AesManaged
½½4 >
(
½½> ?
)
½½? @
)
½½@ A
{
¾¾ 
cd
¿¿ 
.
¿¿ 
	Encrypted
¿¿  
=
¿¿! "
Encrypt
¿¿# *
(
¿¿* +
EncodedString
¿¿+ 8
,
¿¿8 9
aes_managed
¿¿: E
.
¿¿E F
Key
¿¿F I
,
¿¿I J
aes_managed
¿¿K V
.
¿¿V W
IV
¿¿W Y
)
¿¿Y Z
;
¿¿Z [
cd
ÀÀ 
.
ÀÀ 
	Decrypted
ÀÀ  
=
ÀÀ! "
Decrypt
ÀÀ# *
(
ÀÀ* +
cd
ÀÀ+ -
.
ÀÀ- .
	Encrypted
ÀÀ. 7
,
ÀÀ7 8
aes_managed
ÀÀ9 D
.
ÀÀD E
Key
ÀÀE H
,
ÀÀH I
aes_managed
ÀÀJ U
.
ÀÀU V
IV
ÀÀV X
)
ÀÀX Y
;
ÀÀY Z
if
ÂÂ 
(
ÂÂ 
EncodedString
ÂÂ %
.
ÂÂ% &
	CompareTo
ÂÂ& /
(
ÂÂ/ 0
cd
ÂÂ0 2
.
ÂÂ2 3
	Decrypted
ÂÂ3 <
)
ÂÂ< =
==
ÂÂ> @
$num
ÂÂA B
)
ÂÂB C
{
ÃÃ 
cd
ÄÄ 
.
ÄÄ 
Message
ÄÄ "
=
ÄÄ# $
$str
ÄÄ% <
;
ÄÄ< =
cd
ÅÅ 
.
ÅÅ 
Done
ÅÅ 
=
ÅÅ  !
true
ÅÅ" &
;
ÅÅ& '
}
ÆÆ 
else
ÇÇ 
{
ÈÈ 
cd
ÉÉ 
.
ÉÉ 
Done
ÉÉ 
=
ÉÉ  !
false
ÉÉ" '
;
ÉÉ' (
cd
ÊÊ 
.
ÊÊ 
Message
ÊÊ "
=
ÊÊ# $
$str
ÊÊ% }
;
ÊÊ} ~
}
ËË 
}
ÌÌ 
}
ÍÍ 
catch
ÎÎ 
(
ÎÎ 
	Exception
ÎÎ 
ex
ÎÎ 
)
ÎÎ  
{
ÏÏ 
cd
ĞĞ 
.
ĞĞ 
Message
ĞĞ 
=
ĞĞ 
ex
ĞĞ 
.
ĞĞ  
Message
ĞĞ  '
;
ĞĞ' (
cd
ÑÑ 
.
ÑÑ 
Done
ÑÑ 
=
ÑÑ 
false
ÑÑ 
;
ÑÑ  
}
ÒÒ 
return
ÓÓ 
cd
ÓÓ 
;
ÓÓ 
}
ÔÔ 	
byte
ÜÜ 
[
ÜÜ 
]
ÜÜ 
Encrypt
ÜÜ 
(
ÜÜ 
string
ÜÜ 
encryptedText
ÜÜ +
,
ÜÜ+ ,
byte
ÜÜ- 1
[
ÜÜ1 2
]
ÜÜ2 3
Key
ÜÜ4 7
,
ÜÜ7 8
byte
ÜÜ9 =
[
ÜÜ= >
]
ÜÜ> ?
IV
ÜÜ@ B
)
ÜÜB C
{
İİ 	
byte
ŞŞ 
[
ŞŞ 
]
ŞŞ 
	encrypted
ŞŞ 
;
ŞŞ 
using
àà 
(
àà 

AesManaged
àà 
aes_managed
àà )
=
àà* +
new
àà, /

AesManaged
àà0 :
(
àà: ;
)
àà; <
)
àà< =
{
áá 
ICryptoTransform
ââ  
	encryptor
ââ! *
=
ââ+ ,
aes_managed
ââ- 8
.
ââ8 9
CreateEncryptor
ââ9 H
(
ââH I
Key
ââI L
,
ââL M
IV
ââN P
)
ââP Q
;
ââQ R
using
ãã 
(
ãã 
MemoryStream
ãã #
ms
ãã$ &
=
ãã' (
new
ãã) ,
MemoryStream
ãã- 9
(
ãã9 :
)
ãã: ;
)
ãã; <
{
ää 
using
åå 
(
åå 
CryptoStream
åå '
cs
åå( *
=
åå+ ,
new
åå- 0
CryptoStream
åå1 =
(
åå= >
ms
åå> @
,
åå@ A
	encryptor
ååB K
,
ååK L
CryptoStreamMode
ååM ]
.
åå] ^
Write
åå^ c
)
ååc d
)
ååd e
{
ææ 
using
çç 
(
çç 
StreamWriter
çç +
sw
çç, .
=
çç/ 0
new
çç1 4
StreamWriter
çç5 A
(
ççA B
cs
ççB D
)
ççD E
)
ççE F
sw
èè 
.
èè 
Write
èè $
(
èè$ %
encryptedText
èè% 2
)
èè2 3
;
èè3 4
	encrypted
éé !
=
éé" #
ms
éé$ &
.
éé& '
ToArray
éé' .
(
éé. /
)
éé/ 0
;
éé0 1
}
êê 
}
ëë 
}
ìì 
return
íí 
	encrypted
íí 
;
íí 
}
îî 	
string
öö 
Decrypt
öö 
(
öö 
byte
öö 
[
öö 
]
öö 
encryptedText
öö +
,
öö+ ,
byte
öö- 1
[
öö1 2
]
öö2 3
Key
öö4 7
,
öö7 8
byte
öö9 =
[
öö= >
]
öö> ?
IV
öö@ B
)
ööB C
{
÷÷ 	
string
øø 
decryptText
øø 
=
øø  
string
øø! '
.
øø' (
Empty
øø( -
;
øø- .
using
ùù 
(
ùù 

AesManaged
ùù 
aes_managed
ùù )
=
ùù* +
new
ùù, /

AesManaged
ùù0 :
(
ùù: ;
)
ùù; <
)
ùù< =
{
úú 
ICryptoTransform
ûû  
	decryptor
ûû! *
=
ûû+ ,
aes_managed
ûû- 8
.
ûû8 9
CreateDecryptor
ûû9 H
(
ûûH I
Key
ûûI L
,
ûûL M
IV
ûûN P
)
ûûP Q
;
ûûQ R
using
üü 
(
üü 
MemoryStream
üü #
ms
üü$ &
=
üü' (
new
üü) ,
MemoryStream
üü- 9
(
üü9 :
encryptedText
üü: G
)
üüG H
)
üüH I
{
ıı 
using
şş 
(
şş 
CryptoStream
şş '
cs
şş( *
=
şş+ ,
new
şş- 0
CryptoStream
şş1 =
(
şş= >
ms
şş> @
,
şş@ A
	decryptor
şşB K
,
şşK L
CryptoStreamMode
şşM ]
.
şş] ^
Read
şş^ b
)
şşb c
)
şşc d
{
ÿÿ 
using
€€ 
(
€€ 
StreamReader
€€ +
reader
€€, 2
=
€€3 4
new
€€5 8
StreamReader
€€9 E
(
€€E F
cs
€€F H
)
€€H I
)
€€I J
{
 
decryptText
‚‚ '
=
‚‚( )
reader
‚‚* 0
.
‚‚0 1
	ReadToEnd
‚‚1 :
(
‚‚: ;
)
‚‚; <
;
‚‚< =
}
ƒƒ 
}
„„ 
}
…… 
}
‡‡ 
return
ˆˆ 
decryptText
ˆˆ 
;
ˆˆ 
}
‰‰ 	
}
ŠŠ 
}‹‹ –
kC:\Cursos\CodificaciÃ³n Segura\ProyectoFinalSeguridadApps\Business_SeguridadApps\Properties\AssemblyInfo.cs
[ 
assembly 	
:	 

AssemblyTitle 
( 
$str 1
)1 2
]2 3
[		 
assembly		 	
:			 

AssemblyDescription		 
(		 
$str		 /
)		/ 0
]		0 1
[

 
assembly

 	
:

	 
!
AssemblyConfiguration

  
(

  !
$str

! #
)

# $
]

$ %
[ 
assembly 	
:	 

AssemblyCompany 
( 
$str '
)' (
]( )
[ 
assembly 	
:	 

AssemblyProduct 
( 
$str 3
)3 4
]4 5
[ 
assembly 	
:	 

AssemblyCopyright 
( 
$str :
): ;
]; <
[ 
assembly 	
:	 

AssemblyTrademark 
( 
$str 
)  
]  !
[ 
assembly 	
:	 

AssemblyCulture 
( 
$str 
) 
] 
[ 
assembly 	
:	 


ComVisible 
( 
false 
) 
] 
[ 
assembly 	
:	 

Guid 
( 
$str 6
)6 7
]7 8
[## 
assembly## 	
:##	 

AssemblyVersion## 
(## 
$str## $
)##$ %
]##% &
[$$ 
assembly$$ 	
:$$	 

AssemblyFileVersion$$ 
($$ 
$str$$ (
)$$( )
]$$) *›
^C:\Cursos\CodificaciÃ³n Segura\ProyectoFinalSeguridadApps\Business_SeguridadApps\Structures.cs
	namespace 	"
Business_SeguridadApps
  
.  !
StructuresObj! .
{ 
public 

class 
InputResult 
{ 
public 
bool 
IsMatch 
{ 
get !
;! "
set# &
;& '
}( )
public 
string 
Message 
{ 
get  #
;# $
set% (
;( )
}* +
public 
string 
SanitizedString %
{& '
get( +
;+ ,
set- 0
;0 1
}2 3
} 
public 

class 

CreditCard 
{ 
public 
bool 
IsValid 
{ 
get !
;! "
set# &
;& '
}( )
public 
string 
CreditCardNumber &
{' (
get) ,
;, -
set. 1
;1 2
}3 4
public 
string 
CreditCardMasked &
{' (
get) ,
;, -
set. 1
;1 2
}3 4
public 
int 
Index 
{ 
get 
; 
set  #
;# $
}% &
public 
string 
Message 
{ 
get  #
;# $
set% (
;( )
}* +
} 
public## 

class## 

CryptoData## 
{## 
public$$ 
byte$$ 
[$$ 
]$$ 
	Encrypted$$ 
{$$  !
get$$" %
;$$% &
set$$' *
;$$* +
}$$, -
public%% 
string%% 
	Decrypted%% 
{%%  !
get%%" %
;%%% &
set%%' *
;%%* +
}%%, -
public&& 
string&& 
Message&& 
{&& 
get&&  #
;&&# $
set&&% (
;&&( )
}&&* +
public'' 
bool'' 
Done'' 
{'' 
get'' 
;'' 
set''  #
;''# $
}''% &
}(( 	
public,, 

class,, 
EncodingData,, 
{-- 
public.. 

CryptoData.. 

cryptoData.. $
{..% &
get..' *
;..* +
set.., /
;../ 0
}..1 2
public// 
string// 
SHA256// 
{// 
get// "
;//" #
set//$ '
;//' (
}//) *
public00 
string00 
Message00 
{00 
get00  #
;00# $
set00% (
;00( )
}00* +
}11 
}22 